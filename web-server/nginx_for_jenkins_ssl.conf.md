###create new a file with url name
sudo nano /etc/nginx/sites-available/clientjenkins.conf
  server {
        listen 80;
        listen [::]:80;

        server_name clientjenkins.urldrive.in; #this is the domain name map with nginx server ip globally
        access_log /var/log/nginx/jenkins/access.log;
        error_log /var/log/nginx/jenkins/error.log;
# access_log and error_log - These directives specify the path for a server block to write access and error logs.
        location / {
                include /etc/nginx/proxy_params;
                proxy_pass http://localhost:8080;
                proxy_read_timeout  90s;
        # Fix the "It appears that your reverse proxy set up is broken" error.
        # Make sure the domain name is correct
                proxy_redirect      http://localhost:8080 clientjenkins.urldrive.in;
        }
}

#update jenkins configurations
sudo nano /etc/default/jenkins
#uncomment --httpListenAddress and add
--httpListenAddress=127.0.0.1
#at bottom
JENKINS_ARGS="--webroot=/var/cache/$NAME/war --httpPort=$HTTP_PORT --httpListenAddress=127.0.0.1"

#### create new a file with url name
/etc/nginx/sites-available/clientclientapp.conf
server {
        listen 80;
        listen [::]:80;

        server_name client.urldrive.in; #this is the domain name map with nginx server ip globally
        access_log /var/log/nginx/client/access.log;
        error_log /var/log/nginx/client/error.log;
# access_log and error_log - These directives specify the path for a server block to write access and error logs.
        location / {
                proxy_pass http://172.31.28.179:80;  #this is backend server ip with application running port
        }
}

#create softlink of conf file and unlink default page.
#reload jenkins and nginx 
nginx -t
systemctl reload jenkins 
systemctl reload nginx 

#now we can access jenkins at urlmaped:80 

################## after adding ssl to both url after generating ssl certificate ######################
#adding ssl to jenkins url

sudo nano /etc/nginx/sites-available/clientjenkins.conf
server {
        listen 80;
        #listen [::]:80;
        server_name clientjenkins.urldrive.in;
   location / {
        return 301 https://$host$request_uri;
    }
}

server {
     # Binds the TCP port 443 and enable SSL.
        listen 443 ssl;
              # Defines the domain or subdomain name.
        server_name clientjenkins.urldrive.in;

        #path of the ssl certificate
        ssl_certificate /etc/letsencrypt/live/clientjenkins.urldrive.in/fullchain.pem; 
        ssl_certificate_key /etc/letsencrypt/live/clientjenkins.urldrive.in/privkey.pem;
              # Use the file generated by certbot command.
        include /etc/letsencrypt/options-ssl-nginx.conf;
              # Define the path of the dhparam.pem file.
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;


        # access_log and error_log - These directives specify the path for a server block to write access and error logs.
        access_log /var/log/nginx/jenkins/reverse-access.log;
        error_log /var/log/nginx/jenkins/reverse-error.log;

        location / {
                include /etc/nginx/proxy_params;
                proxy_pass http://localhost:8080;
                proxy_read_timeout  90s;
        # Make sure the domain name is correct
                proxy_redirect      http://localhost:8080 clientjenkins.urldrive.in;
        }
}

#check nginx configuration using
$ nginx -t 

$ ln -s /etc/sites-available/client.urldrive.in.conf /etc/sites-enabled/client.urldrive.in.conf

$systemctl reload nginx 

##adding ssl to clientapp url

/etc/nginx/sites-available/clientclientapp.conf

server {
        listen 80;
      # listen [::]:80;

        server_name client.urldrive.in; #this is the domain name map with nginx server ip globally
        location / {
        return 301 https://$host$request_uri;
        }
}

server {
    listen 443 ssl;
       # Defines the domain or subdomain name.
        server_name client.urldrive.in;

        #path of the ssl certificate
        ssl_certificate /etc/letsencrypt/live/client.urldrive.in/fullchain.pem; 
        ssl_certificate_key /etc/letsencrypt/live/client.urldrive.in//privkey.pem;
              # Use the file generated by certbot command.
        include /etc/letsencrypt/options-ssl-nginx.conf;
              # Define the path of the dhparam.pem file.
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

       # access_log and error_log - These directives specify the path for a server block to write access and error logs
        access_log /var/log/nginx/client/access.log;
        error_log /var/log/nginx/client/error.log;


        location / {
                proxy_pass http://172.31.28.179:80;  #this is backend server ip with application running port

        }
}


